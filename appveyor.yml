version: '{build}'

branches:
  only:
  - master

image:
- Visual Studio 2019

configuration:
- Debug
- Release

environment:
  matrix:
  # Comilers matrix
  - env_cmake_generator: "Visual Studio 16 2019"
    env_cmake_architecture: Win32
  - env_cmake_generator: "Visual Studio 16 2019"
    env_cmake_architecture: x64

build_script:
- mkdir build_cmake
- cd build_cmake
- cmake -G "%env_cmake_generator%" -A %env_cmake_architecture% -S ".." -DCMAKE_BUILD_TYPE=%configuration% -DTARGET_CPU=$TARGET_CPU
- cmake --build .
- ctest --output-on-failure

test_script:
- ctest --build-config %configuration%